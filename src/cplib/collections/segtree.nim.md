---
data:
  _extendedDependsOn: []
  _extendedRequiredBy:
  - icon: ':heavy_check_mark:'
    path: cplib/utils/inversion_number.nim
    title: cplib/utils/inversion_number.nim
  - icon: ':heavy_check_mark:'
    path: cplib/utils/inversion_number.nim
    title: cplib/utils/inversion_number.nim
  - icon: ':warning:'
    path: verify/collections/segtree/segtree_get1item_test_.nim
    title: verify/collections/segtree/segtree_get1item_test_.nim
  - icon: ':warning:'
    path: verify/collections/segtree/segtree_get1item_test_.nim
    title: verify/collections/segtree/segtree_get1item_test_.nim
  - icon: ':warning:'
    path: verify/collections/segtree/segtree_xor1_test_.nim
    title: verify/collections/segtree/segtree_xor1_test_.nim
  - icon: ':warning:'
    path: verify/collections/segtree/segtree_xor1_test_.nim
    title: verify/collections/segtree/segtree_xor1_test_.nim
  - icon: ':warning:'
    path: verify/collections/segtree/segtree_xor2_test_.nim
    title: verify/collections/segtree/segtree_xor2_test_.nim
  - icon: ':warning:'
    path: verify/collections/segtree/segtree_xor2_test_.nim
    title: verify/collections/segtree/segtree_xor2_test_.nim
  - icon: ':warning:'
    path: verify/tree/hld/hld_past202004o_test_.nim
    title: verify/tree/hld/hld_past202004o_test_.nim
  - icon: ':warning:'
    path: verify/tree/hld/hld_past202004o_test_.nim
    title: verify/tree/hld/hld_past202004o_test_.nim
  _extendedVerifiedWith:
  - icon: ':heavy_check_mark:'
    path: verify/collections/hashtable_yuki2686_test.nim
    title: verify/collections/hashtable_yuki2686_test.nim
  - icon: ':heavy_check_mark:'
    path: verify/collections/hashtable_yuki2686_test.nim
    title: verify/collections/hashtable_yuki2686_test.nim
  - icon: ':heavy_check_mark:'
    path: verify/collections/segtree/segtree_PARS_test.nim
    title: verify/collections/segtree/segtree_PARS_test.nim
  - icon: ':heavy_check_mark:'
    path: verify/collections/segtree/segtree_PARS_test.nim
    title: verify/collections/segtree/segtree_PARS_test.nim
  - icon: ':heavy_check_mark:'
    path: verify/collections/segtree/segtree_PSRC_2_test.nim
    title: verify/collections/segtree/segtree_PSRC_2_test.nim
  - icon: ':heavy_check_mark:'
    path: verify/collections/segtree/segtree_PSRC_2_test.nim
    title: verify/collections/segtree/segtree_PSRC_2_test.nim
  - icon: ':heavy_check_mark:'
    path: verify/collections/segtree/segtree_PSRC_test.nim
    title: verify/collections/segtree/segtree_PSRC_test.nim
  - icon: ':heavy_check_mark:'
    path: verify/collections/segtree/segtree_PSRC_test.nim
    title: verify/collections/segtree/segtree_PSRC_test.nim
  - icon: ':heavy_check_mark:'
    path: verify/collections/segtree/segtree_RMQ_test.nim
    title: verify/collections/segtree/segtree_RMQ_test.nim
  - icon: ':heavy_check_mark:'
    path: verify/collections/segtree/segtree_RMQ_test.nim
    title: verify/collections/segtree/segtree_RMQ_test.nim
  - icon: ':heavy_check_mark:'
    path: verify/collections/segtree/segtree_init_with_size_test.nim
    title: verify/collections/segtree/segtree_init_with_size_test.nim
  - icon: ':heavy_check_mark:'
    path: verify/collections/segtree/segtree_init_with_size_test.nim
    title: verify/collections/segtree/segtree_init_with_size_test.nim
  - icon: ':heavy_check_mark:'
    path: verify/collections/segtree/segtree_maxright_yuki878_test.nim
    title: verify/collections/segtree/segtree_maxright_yuki878_test.nim
  - icon: ':heavy_check_mark:'
    path: verify/collections/segtree/segtree_maxright_yuki878_test.nim
    title: verify/collections/segtree/segtree_maxright_yuki878_test.nim
  - icon: ':heavy_check_mark:'
    path: verify/collections/segtree/segtree_minleft_yuki878_test.nim
    title: verify/collections/segtree/segtree_minleft_yuki878_test.nim
  - icon: ':heavy_check_mark:'
    path: verify/collections/segtree/segtree_minleft_yuki878_test.nim
    title: verify/collections/segtree/segtree_minleft_yuki878_test.nim
  - icon: ':heavy_check_mark:'
    path: verify/collections/segtree/segtree_newsegwith_test.nim
    title: verify/collections/segtree/segtree_newsegwith_test.nim
  - icon: ':heavy_check_mark:'
    path: verify/collections/segtree/segtree_newsegwith_test.nim
    title: verify/collections/segtree/segtree_newsegwith_test.nim
  - icon: ':heavy_check_mark:'
    path: verify/collections/segtree/segtree_ordered_set_test.nim
    title: verify/collections/segtree/segtree_ordered_set_test.nim
  - icon: ':heavy_check_mark:'
    path: verify/collections/segtree/segtree_ordered_set_test.nim
    title: verify/collections/segtree/segtree_ordered_set_test.nim
  - icon: ':heavy_check_mark:'
    path: verify/collections/segtree/segtree_static_test.nim
    title: verify/collections/segtree/segtree_static_test.nim
  - icon: ':heavy_check_mark:'
    path: verify/collections/segtree/segtree_static_test.nim
    title: verify/collections/segtree/segtree_static_test.nim
  - icon: ':heavy_check_mark:'
    path: verify/tree/hld/hld_vertex_add_path_sum_test.nim
    title: verify/tree/hld/hld_vertex_add_path_sum_test.nim
  - icon: ':heavy_check_mark:'
    path: verify/tree/hld/hld_vertex_add_path_sum_test.nim
    title: verify/tree/hld/hld_vertex_add_path_sum_test.nim
  - icon: ':heavy_check_mark:'
    path: verify/tree/hld/hld_vertex_add_subtree_sum_test.nim
    title: verify/tree/hld/hld_vertex_add_subtree_sum_test.nim
  - icon: ':heavy_check_mark:'
    path: verify/tree/hld/hld_vertex_add_subtree_sum_test.nim
    title: verify/tree/hld/hld_vertex_add_subtree_sum_test.nim
  - icon: ':heavy_check_mark:'
    path: verify/tree/hld/hld_vertex_set_path_composite_test.nim
    title: verify/tree/hld/hld_vertex_set_path_composite_test.nim
  - icon: ':heavy_check_mark:'
    path: verify/tree/hld/hld_vertex_set_path_composite_test.nim
    title: verify/tree/hld/hld_vertex_set_path_composite_test.nim
  - icon: ':heavy_check_mark:'
    path: verify/utils/inversion_number_test.nim
    title: verify/utils/inversion_number_test.nim
  - icon: ':heavy_check_mark:'
    path: verify/utils/inversion_number_test.nim
    title: verify/utils/inversion_number_test.nim
  _isVerificationFailed: false
  _pathExtension: nim
  _verificationStatusIcon: ':heavy_check_mark:'
  attributes:
    links: []
  bundledCode: "Traceback (most recent call last):\n  File \"/home/runner/.local/lib/python3.12/site-packages/onlinejudge_verify/documentation/build.py\"\
    , line 71, in _render_source_code_stat\n    bundled_code = language.bundle(stat.path,\
    \ basedir=basedir, options={'include_paths': [basedir]}).decode()\n          \
    \         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n\
    \  File \"/home/runner/.local/lib/python3.12/site-packages/onlinejudge_verify/languages/nim.py\"\
    , line 86, in bundle\n    raise NotImplementedError\nNotImplementedError\n"
  code: "when not declared CPLIB_COLLECTIONS_SEGTREE:\n    const CPLIB_COLLECTIONS_SEGTREE*\
    \ = 1\n    import algorithm, strutils, sequtils\n    type SegmentTree*[T] = ref\
    \ object\n        default: T\n        merge: proc(x: T, y: T): T\n        arr*:\
    \ seq[T]\n        lastnode: int\n        length: int\n    proc initSegmentTree*[T](v:\
    \ seq[T], merge: proc(x: T, y: T): T, default: T): SegmentTree[T] =\n        ##\
    \ \u30BB\u30B0\u30E1\u30F3\u30C8\u30C4\u30EA\u30FC\u3092\u751F\u6210\u3057\u307E\
    \u3059\u3002\n        ## v\u306B\u5143\u3068\u306A\u308B\u30EA\u30B9\u30C8\u3001\
    merge\u306B\u4E8C\u3064\u306E\u533A\u9593\u3092\u30DE\u30FC\u30B8\u3059\u308B\u95A2\
    \u6570\u3001\u30C7\u30D5\u30A9\u30EB\u30C8\u306B\u5358\u4F4D\u5143\u3092\u4E0E\
    \u3048\u3066\u304F\u3060\u3055\u3044\u3002\n        var lastnode = 1\n       \
    \ while lastnode < len(v):\n            lastnode*=2\n        var arr = newSeq[T](2*lastnode)\n\
    \        arr.fill(default)\n        var self = SegmentTree[T](default: default,\
    \ merge: merge, arr: arr, lastnode: lastnode, length: len(v))\n        #1-indexed\u3067\
    \u4F5C\u6210\u3059\u308B\n        for i in 0..<len(v):\n            self.arr[self.lastnode+i]\
    \ = v[i]\n        for i in countdown(lastnode-1, 1):\n            self.arr[i]\
    \ = self.merge(self.arr[2*i], self.arr[2*i+1])\n        return self\n    proc\
    \ initSegmentTree*[T](n: int, merge: proc(x: T, y: T): T, default: T): SegmentTree[T]\
    \ =\n        ## \u30BB\u30B0\u30E1\u30F3\u30C8\u30C4\u30EA\u30FC\u3092\u751F\u6210\
    \u3057\u307E\u3059\u3002\n        ## n\u306B\u30B5\u30A4\u30BA\u3001merge\u306B\
    \u4E8C\u3064\u306E\u533A\u9593\u3092\u30DE\u30FC\u30B8\u3059\u308B\u95A2\u6570\
    \u3001\u30C7\u30D5\u30A9\u30EB\u30C8\u306B\u5358\u4F4D\u5143\u3092\u4E0E\u3048\
    \u3066\u304F\u3060\u3055\u3044\u3002\uFF08\u5168\u3066\u5358\u4F4D\u5143\u3067\
    \u69CB\u7BC9\u3055\u308C\u307E\u3059\uFF09\n        initSegmentTree(newSeqWith(n,\
    \ default), merge, default)\n\n    proc update*[T](self: SegmentTree[T], x: Natural,\
    \ val: T) =\n        ## x\u306E\u8981\u7D20\u3092val\u306B\u5909\u66F4\u3057\u307E\
    \u3059\u3002\n        assert x < self.length\n        var x = x\n        x +=\
    \ self.lastnode\n        self.arr[x] = val\n        while x > 1:\n           \
    \ x = x shr 1\n            self.arr[x] = self.merge(self.arr[2*x], self.arr[2*x+1])\n\
    \    proc get*[T](self: SegmentTree[T], q_left: Natural, q_right: Natural): T\
    \ =\n        ## \u534A\u89E3\u533A\u9593[q_left,q_right)\u306B\u3064\u3044\u3066\
    \u306E\u6F14\u7B97\u7D50\u679C\u3092\u8FD4\u3057\u307E\u3059\u3002\n        assert\
    \ q_left <= q_right and 0 <= q_left and q_right <= self.length\n        var q_left\
    \ = q_left\n        var q_right = q_right\n        q_left += self.lastnode\n \
    \       q_right += self.lastnode\n        var (lres, rres) = (self.default, self.default)\n\
    \        while q_left < q_right:\n            if (q_left and 1) > 0:\n       \
    \         lres = self.merge(lres, self.arr[q_left])\n                q_left +=\
    \ 1\n            if (q_right and 1) > 0:\n                q_right -= 1\n     \
    \           rres = self.merge(self.arr[q_right], rres)\n            q_left = q_left\
    \ shr 1\n            q_right = q_right shr 1\n        return self.merge(lres,\
    \ rres)\n    proc get*[T](self: SegmentTree[T], segment: HSlice[int, int]): T\
    \ =\n        assert segment.a <= segment.b + 1 and 0 <= segment.a and segment.b+1\
    \ <= self.length\n        return self.get(segment.a, segment.b+1)\n    proc `[]`*[T](self:\
    \ SegmentTree[T], segment: HSlice[int, int]): T = self.get(segment)\n    proc\
    \ `[]`*[T](self: SegmentTree[T], index: Natural): T =\n        assert index <\
    \ self.length\n        return self.arr[index+self.lastnode]\n    proc `[]=`*[T](self:\
    \ SegmentTree[T], index: Natural, val: T) =\n        assert index < self.length\n\
    \        self.update(index, val)\n    proc get_all*[T](self: SegmentTree[T]):\
    \ T =\n        ## [0,len(self))\u533A\u9593\u306E\u6F14\u7B97\u7D50\u679C\u3092\
    O(1)\u3067\u8FD4\u3059\n        return self.arr[1]\n    proc len*[T](self: SegmentTree[T]):\
    \ int =\n        return self.length\n    proc `$`*[T](self: SegmentTree[T]): string\
    \ =\n        var s = self.arr.len div 2\n        return self.arr[s..<s+self.len].join(\"\
    \ \")\n    template newSegWith*(V, merge, default: untyped): untyped =\n     \
    \   initSegmentTree[typeof(default)](V, proc (l{.inject.}, r{.inject.}: typeof(default)):\
    \ typeof(default) = merge, default)\n    proc max_right*[T](self: SegmentTree[T],\
    \ l: int, f: proc(l: T): bool): int =\n        assert 0 <= l and l <= self.len\n\
    \        assert f(self.default)\n        if l == self.len: return self.len\n \
    \       var l = l + self.lastnode\n        var sm = self.default\n        while\
    \ true:\n            while l mod 2 == 0: l = (l shr 1)\n            if not f(self.merge(sm,\
    \ self.arr[l])):\n                while l < self.lastnode:\n                 \
    \   l *= 2\n                    if f(self.merge(sm, self.arr[l])):\n         \
    \               sm = self.merge(sm, self.arr[l])\n                        l +=\
    \ 1\n                return l - self.lastnode\n            sm = self.merge(sm,\
    \ self.arr[l])\n            l += 1\n            if (l and -l) == l: break\n  \
    \      return self.len\n    proc min_left*[T](self: SegmentTree[T], r: int, f:\
    \ proc(l: T): bool): int =\n        assert 0 <= r and r <= self.len\n        assert\
    \ f(self.default)\n        if r == 0: return 0\n        var r = r + self.lastnode\n\
    \        var sm = self.default\n        while true:\n            r -= 1\n    \
    \        while ((r > 1) and (r mod 2 != 0)): r = (r shr 1)\n            if not\
    \ f(self.merge(self.arr[r], sm)):\n                while r < self.lastnode:\n\
    \                    r = 2 * r + 1\n                    if f(self.merge(self.arr[r],\
    \ sm)):\n                        sm = self.merge(self.arr[r], sm)\n          \
    \              r -= 1\n                return r + 1 - self.lastnode\n        \
    \    sm = self.merge(self.arr[r], sm)\n            if (r and -r) == r: break\n\
    \        return 0\n"
  dependsOn: []
  isVerificationFile: false
  path: cplib/collections/segtree.nim
  requiredBy:
  - verify/tree/hld/hld_past202004o_test_.nim
  - verify/tree/hld/hld_past202004o_test_.nim
  - verify/collections/segtree/segtree_xor1_test_.nim
  - verify/collections/segtree/segtree_xor1_test_.nim
  - verify/collections/segtree/segtree_get1item_test_.nim
  - verify/collections/segtree/segtree_get1item_test_.nim
  - verify/collections/segtree/segtree_xor2_test_.nim
  - verify/collections/segtree/segtree_xor2_test_.nim
  - cplib/utils/inversion_number.nim
  - cplib/utils/inversion_number.nim
  timestamp: '2024-12-19 23:19:11+09:00'
  verificationStatus: LIBRARY_ALL_AC
  verifiedWith:
  - verify/tree/hld/hld_vertex_add_subtree_sum_test.nim
  - verify/tree/hld/hld_vertex_add_subtree_sum_test.nim
  - verify/tree/hld/hld_vertex_add_path_sum_test.nim
  - verify/tree/hld/hld_vertex_add_path_sum_test.nim
  - verify/tree/hld/hld_vertex_set_path_composite_test.nim
  - verify/tree/hld/hld_vertex_set_path_composite_test.nim
  - verify/utils/inversion_number_test.nim
  - verify/utils/inversion_number_test.nim
  - verify/collections/segtree/segtree_PSRC_test.nim
  - verify/collections/segtree/segtree_PSRC_test.nim
  - verify/collections/segtree/segtree_minleft_yuki878_test.nim
  - verify/collections/segtree/segtree_minleft_yuki878_test.nim
  - verify/collections/segtree/segtree_init_with_size_test.nim
  - verify/collections/segtree/segtree_init_with_size_test.nim
  - verify/collections/segtree/segtree_ordered_set_test.nim
  - verify/collections/segtree/segtree_ordered_set_test.nim
  - verify/collections/segtree/segtree_PARS_test.nim
  - verify/collections/segtree/segtree_PARS_test.nim
  - verify/collections/segtree/segtree_static_test.nim
  - verify/collections/segtree/segtree_static_test.nim
  - verify/collections/segtree/segtree_newsegwith_test.nim
  - verify/collections/segtree/segtree_newsegwith_test.nim
  - verify/collections/segtree/segtree_maxright_yuki878_test.nim
  - verify/collections/segtree/segtree_maxright_yuki878_test.nim
  - verify/collections/segtree/segtree_PSRC_2_test.nim
  - verify/collections/segtree/segtree_PSRC_2_test.nim
  - verify/collections/segtree/segtree_RMQ_test.nim
  - verify/collections/segtree/segtree_RMQ_test.nim
  - verify/collections/hashtable_yuki2686_test.nim
  - verify/collections/hashtable_yuki2686_test.nim
documentation_of: cplib/collections/segtree.nim
layout: document
redirect_from:
- /library/cplib/collections/segtree.nim
- /library/cplib/collections/segtree.nim.html
title: cplib/collections/segtree.nim
---

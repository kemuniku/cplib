---
data:
  _extendedDependsOn: []
  _extendedRequiredBy:
  - icon: ':heavy_check_mark:'
    path: cplib/modint/modint.nim
    title: cplib/modint/modint.nim
  - icon: ':heavy_check_mark:'
    path: cplib/modint/modint.nim
    title: cplib/modint/modint.nim
  _extendedVerifiedWith:
  - icon: ':heavy_check_mark:'
    path: verify/matrix/matrix_pow_test.nim
    title: verify/matrix/matrix_pow_test.nim
  - icon: ':heavy_check_mark:'
    path: verify/matrix/matrix_pow_test.nim
    title: verify/matrix/matrix_pow_test.nim
  - icon: ':heavy_check_mark:'
    path: verify/matrix/matrix_product_test.nim
    title: verify/matrix/matrix_product_test.nim
  - icon: ':heavy_check_mark:'
    path: verify/matrix/matrix_product_test.nim
    title: verify/matrix/matrix_product_test.nim
  - icon: ':heavy_check_mark:'
    path: verify/modint/barrett/abc277g_dynamic_test.nim
    title: verify/modint/barrett/abc277g_dynamic_test.nim
  - icon: ':heavy_check_mark:'
    path: verify/modint/barrett/abc277g_dynamic_test.nim
    title: verify/modint/barrett/abc277g_dynamic_test.nim
  - icon: ':heavy_check_mark:'
    path: verify/modint/barrett/abc277g_static_test.nim
    title: verify/modint/barrett/abc277g_static_test.nim
  - icon: ':heavy_check_mark:'
    path: verify/modint/barrett/abc277g_static_test.nim
    title: verify/modint/barrett/abc277g_static_test.nim
  - icon: ':heavy_check_mark:'
    path: verify/modint/barrett/dpr_dynamic_test.nim
    title: verify/modint/barrett/dpr_dynamic_test.nim
  - icon: ':heavy_check_mark:'
    path: verify/modint/barrett/dpr_dynamic_test.nim
    title: verify/modint/barrett/dpr_dynamic_test.nim
  - icon: ':heavy_check_mark:'
    path: verify/modint/barrett/dpr_static_test.nim
    title: verify/modint/barrett/dpr_static_test.nim
  - icon: ':heavy_check_mark:'
    path: verify/modint/barrett/dpr_static_test.nim
    title: verify/modint/barrett/dpr_static_test.nim
  - icon: ':heavy_check_mark:'
    path: verify/modint/barrett/keyence2021_dynamic_staticinv_test.nim
    title: verify/modint/barrett/keyence2021_dynamic_staticinv_test.nim
  - icon: ':heavy_check_mark:'
    path: verify/modint/barrett/keyence2021_dynamic_staticinv_test.nim
    title: verify/modint/barrett/keyence2021_dynamic_staticinv_test.nim
  - icon: ':heavy_check_mark:'
    path: verify/modint/barrett/keyence2021_dynamic_test.nim
    title: verify/modint/barrett/keyence2021_dynamic_test.nim
  - icon: ':heavy_check_mark:'
    path: verify/modint/barrett/keyence2021_dynamic_test.nim
    title: verify/modint/barrett/keyence2021_dynamic_test.nim
  - icon: ':heavy_check_mark:'
    path: verify/modint/barrett/keyence2021_static_staticinv_test.nim
    title: verify/modint/barrett/keyence2021_static_staticinv_test.nim
  - icon: ':heavy_check_mark:'
    path: verify/modint/barrett/keyence2021_static_staticinv_test.nim
    title: verify/modint/barrett/keyence2021_static_staticinv_test.nim
  - icon: ':heavy_check_mark:'
    path: verify/modint/barrett/keyence2021_static_test.nim
    title: verify/modint/barrett/keyence2021_static_test.nim
  - icon: ':heavy_check_mark:'
    path: verify/modint/barrett/keyence2021_static_test.nim
    title: verify/modint/barrett/keyence2021_static_test.nim
  - icon: ':heavy_check_mark:'
    path: verify/modint/montgomery/abc277g_dynamic_test.nim
    title: verify/modint/montgomery/abc277g_dynamic_test.nim
  - icon: ':heavy_check_mark:'
    path: verify/modint/montgomery/abc277g_dynamic_test.nim
    title: verify/modint/montgomery/abc277g_dynamic_test.nim
  - icon: ':heavy_check_mark:'
    path: verify/modint/montgomery/abc277g_static_test.nim
    title: verify/modint/montgomery/abc277g_static_test.nim
  - icon: ':heavy_check_mark:'
    path: verify/modint/montgomery/abc277g_static_test.nim
    title: verify/modint/montgomery/abc277g_static_test.nim
  - icon: ':heavy_check_mark:'
    path: verify/modint/montgomery/dpr_dynamic_test.nim
    title: verify/modint/montgomery/dpr_dynamic_test.nim
  - icon: ':heavy_check_mark:'
    path: verify/modint/montgomery/dpr_dynamic_test.nim
    title: verify/modint/montgomery/dpr_dynamic_test.nim
  - icon: ':heavy_check_mark:'
    path: verify/modint/montgomery/dpr_static_test.nim
    title: verify/modint/montgomery/dpr_static_test.nim
  - icon: ':heavy_check_mark:'
    path: verify/modint/montgomery/dpr_static_test.nim
    title: verify/modint/montgomery/dpr_static_test.nim
  - icon: ':heavy_check_mark:'
    path: verify/modint/montgomery/keyence2021_dynamic_staticinv_test.nim
    title: verify/modint/montgomery/keyence2021_dynamic_staticinv_test.nim
  - icon: ':heavy_check_mark:'
    path: verify/modint/montgomery/keyence2021_dynamic_staticinv_test.nim
    title: verify/modint/montgomery/keyence2021_dynamic_staticinv_test.nim
  - icon: ':heavy_check_mark:'
    path: verify/modint/montgomery/keyence2021_dynamic_test.nim
    title: verify/modint/montgomery/keyence2021_dynamic_test.nim
  - icon: ':heavy_check_mark:'
    path: verify/modint/montgomery/keyence2021_dynamic_test.nim
    title: verify/modint/montgomery/keyence2021_dynamic_test.nim
  - icon: ':heavy_check_mark:'
    path: verify/modint/montgomery/keyence2021_static_staticinv_test.nim
    title: verify/modint/montgomery/keyence2021_static_staticinv_test.nim
  - icon: ':heavy_check_mark:'
    path: verify/modint/montgomery/keyence2021_static_staticinv_test.nim
    title: verify/modint/montgomery/keyence2021_static_staticinv_test.nim
  - icon: ':heavy_check_mark:'
    path: verify/modint/montgomery/keyence2021_static_test.nim
    title: verify/modint/montgomery/keyence2021_static_test.nim
  - icon: ':heavy_check_mark:'
    path: verify/modint/montgomery/keyence2021_static_test.nim
    title: verify/modint/montgomery/keyence2021_static_test.nim
  - icon: ':heavy_check_mark:'
    path: verify/tree/diameter_path_dynamic_test.nim
    title: verify/tree/diameter_path_dynamic_test.nim
  - icon: ':heavy_check_mark:'
    path: verify/tree/diameter_path_dynamic_test.nim
    title: verify/tree/diameter_path_dynamic_test.nim
  - icon: ':heavy_check_mark:'
    path: verify/tree/diameter_path_static_test.nim
    title: verify/tree/diameter_path_static_test.nim
  - icon: ':heavy_check_mark:'
    path: verify/tree/diameter_path_static_test.nim
    title: verify/tree/diameter_path_static_test.nim
  _isVerificationFailed: false
  _pathExtension: nim
  _verificationStatusIcon: ':heavy_check_mark:'
  attributes:
    links: []
  bundledCode: "Traceback (most recent call last):\n  File \"/home/runner/.local/lib/python3.10/site-packages/onlinejudge_verify/documentation/build.py\"\
    , line 71, in _render_source_code_stat\n    bundled_code = language.bundle(stat.path,\
    \ basedir=basedir, options={'include_paths': [basedir]}).decode()\n  File \"/home/runner/.local/lib/python3.10/site-packages/onlinejudge_verify/languages/nim.py\"\
    , line 86, in bundle\n    raise NotImplementedError\nNotImplementedError\n"
  code: "when not declared CPLIB_MODINT_MODINT_BARRETT:\n    const CPLIB_MODINT_MODINT_BARRETT*\
    \ = 1\n    import std/macros\n    type StaticBarrettModint*[M: static[uint32]]\
    \ = object\n        a: uint32\n    type DynamicBarrettModint*[M: static[uint32]]\
    \ = object\n        a: uint32\n    type BarrettModint* = StaticBarrettModint or\
    \ DynamicBarrettModint\n\n    proc get_im*(M: uint32): uint = cast[uint](-1) div\
    \ M + 1\n    func get_param*[M: static[uint32]](self: typedesc[DynamicBarrettModint[M]]):\
    \ ptr[tuple[M, im: uint]] =\n        {.cast(noSideEffect).}:\n            var\
    \ p {.global.}: tuple[M, im: uint] = (998244353u, get_im(998244353u32))\n    \
    \        return p.addr\n    template get_M*(T: typedesc[BarrettModint]): uint\
    \ =\n        when T is StaticBarrettModint: T.M.uint\n        else: (get_param(T))[].M.uint\n\
    \    proc setMod*[T: static[uint32]](self: typedesc[DynamicBarrettModint[T]],\
    \ M: SomeInteger or SomeUnsignedInt) =\n        (get_param(self))[] = (M: M.uint,\
    \ im: get_im(M.uint32))\n\n    template umod*[T: BarrettModint](self: typedesc[T]\
    \ or T): uint32 =\n        when self is typedesc:\n            when self is StaticBarrettModint:\
    \ self.M\n            else: cast[uint32](((get_param(self))[]).M)\n        else:\
    \ T.umod\n    template `mod`*[T: BarrettModint](self: typedesc[T] or T): int32\
    \ = (T.umod).int32\n    {.emit: \"\"\"\n    #include <cstdio>\n    inline unsigned\
    \ long long calc_mul(const unsigned long long &a, const unsigned long long &b)\
    \ {\n        return (unsigned long long)(((__uint128_t)(a) * b) >> 64);\n    }\n\
    \    \"\"\".}\n    proc calc_mul*(a, b: culonglong): culonglong {.importcpp: \"\
    calc_mul(#, #)\", nodecl, inline.}\n    proc rem*(T: typedesc[BarrettModint],\
    \ a: uint): uint32 =\n        when T is StaticBarrettModint:\n            const\
    \ im = get_im(T.M)\n            const M = get_M(T)\n            var x = (calc_mul(cast[culonglong](a),\
    \ cast[culonglong](im))).uint\n            var r = a - x * M\n            if M\
    \ <= r: r += M\n            return cast[uint32](r)\n        else:\n          \
    \  var p = get_param(T)[]\n            var x = (calc_mul(cast[culonglong](a),\
    \ cast[culonglong](p.im))).uint\n            var r = a - x * p.M\n           \
    \ if p.M <= r: r += p.M\n            return cast[uint32](r)\n    proc init*(T:\
    \ typedesc[BarrettModint], a: T or SomeInteger): auto =\n        when a is T:\
    \ return a\n        else:\n            if a in 0..<T.mod.int: return T(a: a.uint32)\n\
    \            var a = a mod T.mod.int\n            if a < 0: a += T.mod.int\n \
    \           return T(a: a.uint32)\n\n    proc `-`*[T: BarrettModint](a: T): T\
    \ = T(a: T.umod - a.a)\n    proc `+=`*[T: BarrettModint](a: var T, b: T or SomeInteger)\
    \ =\n        a.a += init(T, b).a\n        if a.a >= T.umod: a.a -= T.umod\n  \
    \  proc `-=`*[T: BarrettModint](a: var T, b: T or SomeInteger) =\n        a.a\
    \ -= init(T, b).a\n        if a.a >= T.umod: a.a += T.umod\n    proc `*=`*[T:\
    \ BarrettModint] (a: var T, b: T or SomeInteger) =\n        a.a = rem(T, (a.a).uint\
    \ * (init(T, b).a).uint)\n    proc inv*[T: BarrettModint](x: T): T =\n       \
    \ var x: int32 = int32(x.val)\n        var y: int32 = T.mod\n        var u = 1i32\n\
    \        var v, t = 0i32\n        while y > 0:\n            t = x div y\n    \
    \        x -= t * y\n            u -= t * v\n            swap(x, y)\n        \
    \    swap(u, v)\n        return init(T, u)\n    proc `/=`*[T: BarrettModint](a:\
    \ var T, b: T or SomeInteger) = a *= init(T, b).inv\n    proc val*(a: BarrettModint):\
    \ int = a.a.int\n    macro declarStaticBarrettModint*(name, M) =\n        let\
    \ converter_name = ident(\"to\" & $`name`)\n        quote do:\n            type\
    \ `name`* = StaticBarrettModint[`M`]\n            converter `converter_name`*(a:\
    \ int): StaticBarrettModint[`M`] = init(StaticBarrettModint[`M`], a)\n    macro\
    \ declarDynamicBarrettModint*(name, id) =\n        let converter_name = ident(\"\
    to\" & $`name`)\n        quote do:\n            type `name`* = DynamicBarrettModint[`id`]\n\
    \            converter `converter_name`*(a: int): DynamicBarrettModint[`id`] =\
    \ init(DynamicBarrettModint[`id`], a)\n"
  dependsOn: []
  isVerificationFile: false
  path: cplib/modint/barrett_impl.nim
  requiredBy:
  - cplib/modint/modint.nim
  - cplib/modint/modint.nim
  timestamp: '2024-04-12 16:59:42+09:00'
  verificationStatus: LIBRARY_ALL_AC
  verifiedWith:
  - verify/modint/montgomery/keyence2021_static_staticinv_test.nim
  - verify/modint/montgomery/keyence2021_static_staticinv_test.nim
  - verify/modint/montgomery/abc277g_static_test.nim
  - verify/modint/montgomery/abc277g_static_test.nim
  - verify/modint/montgomery/keyence2021_dynamic_test.nim
  - verify/modint/montgomery/keyence2021_dynamic_test.nim
  - verify/modint/montgomery/keyence2021_static_test.nim
  - verify/modint/montgomery/keyence2021_static_test.nim
  - verify/modint/montgomery/keyence2021_dynamic_staticinv_test.nim
  - verify/modint/montgomery/keyence2021_dynamic_staticinv_test.nim
  - verify/modint/montgomery/dpr_static_test.nim
  - verify/modint/montgomery/dpr_static_test.nim
  - verify/modint/montgomery/dpr_dynamic_test.nim
  - verify/modint/montgomery/dpr_dynamic_test.nim
  - verify/modint/montgomery/abc277g_dynamic_test.nim
  - verify/modint/montgomery/abc277g_dynamic_test.nim
  - verify/modint/barrett/keyence2021_static_staticinv_test.nim
  - verify/modint/barrett/keyence2021_static_staticinv_test.nim
  - verify/modint/barrett/abc277g_static_test.nim
  - verify/modint/barrett/abc277g_static_test.nim
  - verify/modint/barrett/keyence2021_dynamic_test.nim
  - verify/modint/barrett/keyence2021_dynamic_test.nim
  - verify/modint/barrett/keyence2021_static_test.nim
  - verify/modint/barrett/keyence2021_static_test.nim
  - verify/modint/barrett/keyence2021_dynamic_staticinv_test.nim
  - verify/modint/barrett/keyence2021_dynamic_staticinv_test.nim
  - verify/modint/barrett/dpr_static_test.nim
  - verify/modint/barrett/dpr_static_test.nim
  - verify/modint/barrett/dpr_dynamic_test.nim
  - verify/modint/barrett/dpr_dynamic_test.nim
  - verify/modint/barrett/abc277g_dynamic_test.nim
  - verify/modint/barrett/abc277g_dynamic_test.nim
  - verify/matrix/matrix_pow_test.nim
  - verify/matrix/matrix_pow_test.nim
  - verify/matrix/matrix_product_test.nim
  - verify/matrix/matrix_product_test.nim
  - verify/tree/diameter_path_static_test.nim
  - verify/tree/diameter_path_static_test.nim
  - verify/tree/diameter_path_dynamic_test.nim
  - verify/tree/diameter_path_dynamic_test.nim
documentation_of: cplib/modint/barrett_impl.nim
layout: document
redirect_from:
- /library/cplib/modint/barrett_impl.nim
- /library/cplib/modint/barrett_impl.nim.html
title: cplib/modint/barrett_impl.nim
---

---
data:
  _extendedDependsOn: []
  _extendedRequiredBy:
  - icon: ':heavy_check_mark:'
    path: cplib/collections/avlset.nim
    title: cplib/collections/avlset.nim
  - icon: ':heavy_check_mark:'
    path: cplib/collections/avlset.nim
    title: cplib/collections/avlset.nim
  - icon: ':heavy_check_mark:'
    path: cplib/utils/grid_searcher.nim
    title: cplib/utils/grid_searcher.nim
  - icon: ':heavy_check_mark:'
    path: cplib/utils/grid_searcher.nim
    title: cplib/utils/grid_searcher.nim
  _extendedVerifiedWith:
  - icon: ':heavy_check_mark:'
    path: verify/collections/avlset/multiset/ABC217_gele_test.nim
    title: verify/collections/avlset/multiset/ABC217_gele_test.nim
  - icon: ':heavy_check_mark:'
    path: verify/collections/avlset/multiset/ABC217_gele_test.nim
    title: verify/collections/avlset/multiset/ABC217_gele_test.nim
  - icon: ':heavy_check_mark:'
    path: verify/collections/avlset/multiset/ABC217_gtlt_test.nim
    title: verify/collections/avlset/multiset/ABC217_gtlt_test.nim
  - icon: ':heavy_check_mark:'
    path: verify/collections/avlset/multiset/ABC217_gtlt_test.nim
    title: verify/collections/avlset/multiset/ABC217_gtlt_test.nim
  - icon: ':heavy_check_mark:'
    path: verify/collections/avlset/multiset/ABC217_index_test.nim
    title: verify/collections/avlset/multiset/ABC217_index_test.nim
  - icon: ':heavy_check_mark:'
    path: verify/collections/avlset/multiset/ABC217_index_test.nim
    title: verify/collections/avlset/multiset/ABC217_index_test.nim
  - icon: ':heavy_check_mark:'
    path: verify/collections/avlset/multiset/ABC234D_access_test.nim
    title: verify/collections/avlset/multiset/ABC234D_access_test.nim
  - icon: ':heavy_check_mark:'
    path: verify/collections/avlset/multiset/ABC234D_access_test.nim
    title: verify/collections/avlset/multiset/ABC234D_access_test.nim
  - icon: ':heavy_check_mark:'
    path: verify/collections/avlset/multiset/ABC236_test.nim
    title: verify/collections/avlset/multiset/ABC236_test.nim
  - icon: ':heavy_check_mark:'
    path: verify/collections/avlset/multiset/ABC236_test.nim
    title: verify/collections/avlset/multiset/ABC236_test.nim
  - icon: ':heavy_check_mark:'
    path: verify/collections/avlset/multiset/ABC294_test.nim
    title: verify/collections/avlset/multiset/ABC294_test.nim
  - icon: ':heavy_check_mark:'
    path: verify/collections/avlset/multiset/ABC294_test.nim
    title: verify/collections/avlset/multiset/ABC294_test.nim
  - icon: ':heavy_check_mark:'
    path: verify/collections/avlset/multiset/ABC337_test.nim
    title: verify/collections/avlset/multiset/ABC337_test.nim
  - icon: ':heavy_check_mark:'
    path: verify/collections/avlset/multiset/ABC337_test.nim
    title: verify/collections/avlset/multiset/ABC337_test.nim
  - icon: ':heavy_check_mark:'
    path: verify/collections/avlset/multiset/index_right_test.nim
    title: verify/collections/avlset/multiset/index_right_test.nim
  - icon: ':heavy_check_mark:'
    path: verify/collections/avlset/multiset/index_right_test.nim
    title: verify/collections/avlset/multiset/index_right_test.nim
  - icon: ':heavy_check_mark:'
    path: verify/collections/avlset/set/ABC217_gele_test.nim
    title: verify/collections/avlset/set/ABC217_gele_test.nim
  - icon: ':heavy_check_mark:'
    path: verify/collections/avlset/set/ABC217_gele_test.nim
    title: verify/collections/avlset/set/ABC217_gele_test.nim
  - icon: ':heavy_check_mark:'
    path: verify/collections/avlset/set/ABC217_gtlt_test.nim
    title: verify/collections/avlset/set/ABC217_gtlt_test.nim
  - icon: ':heavy_check_mark:'
    path: verify/collections/avlset/set/ABC217_gtlt_test.nim
    title: verify/collections/avlset/set/ABC217_gtlt_test.nim
  - icon: ':heavy_check_mark:'
    path: verify/collections/avlset/set/ABC217_index_test.nim
    title: verify/collections/avlset/set/ABC217_index_test.nim
  - icon: ':heavy_check_mark:'
    path: verify/collections/avlset/set/ABC217_index_test.nim
    title: verify/collections/avlset/set/ABC217_index_test.nim
  - icon: ':heavy_check_mark:'
    path: verify/collections/avlset/set/ABC234D_access_test.nim
    title: verify/collections/avlset/set/ABC234D_access_test.nim
  - icon: ':heavy_check_mark:'
    path: verify/collections/avlset/set/ABC234D_access_test.nim
    title: verify/collections/avlset/set/ABC234D_access_test.nim
  - icon: ':heavy_check_mark:'
    path: verify/collections/avlset/set/ABC236_test.nim
    title: verify/collections/avlset/set/ABC236_test.nim
  - icon: ':heavy_check_mark:'
    path: verify/collections/avlset/set/ABC236_test.nim
    title: verify/collections/avlset/set/ABC236_test.nim
  - icon: ':heavy_check_mark:'
    path: verify/collections/avlset/set/ABC294_test.nim
    title: verify/collections/avlset/set/ABC294_test.nim
  - icon: ':heavy_check_mark:'
    path: verify/collections/avlset/set/ABC294_test.nim
    title: verify/collections/avlset/set/ABC294_test.nim
  - icon: ':heavy_check_mark:'
    path: verify/utils/grid_searcher/skate_get_test.nim
    title: verify/utils/grid_searcher/skate_get_test.nim
  - icon: ':heavy_check_mark:'
    path: verify/utils/grid_searcher/skate_get_test.nim
    title: verify/utils/grid_searcher/skate_get_test.nim
  - icon: ':heavy_check_mark:'
    path: verify/utils/grid_searcher/skate_get_tuple_test.nim
    title: verify/utils/grid_searcher/skate_get_tuple_test.nim
  - icon: ':heavy_check_mark:'
    path: verify/utils/grid_searcher/skate_get_tuple_test.nim
    title: verify/utils/grid_searcher/skate_get_tuple_test.nim
  - icon: ':heavy_check_mark:'
    path: verify/utils/grid_searcher/skate_test.nim
    title: verify/utils/grid_searcher/skate_test.nim
  - icon: ':heavy_check_mark:'
    path: verify/utils/grid_searcher/skate_test.nim
    title: verify/utils/grid_searcher/skate_test.nim
  - icon: ':heavy_check_mark:'
    path: verify/utils/grid_searcher/skate_tuple_test.nim
    title: verify/utils/grid_searcher/skate_tuple_test.nim
  - icon: ':heavy_check_mark:'
    path: verify/utils/grid_searcher/skate_tuple_test.nim
    title: verify/utils/grid_searcher/skate_tuple_test.nim
  _isVerificationFailed: false
  _pathExtension: nim
  _verificationStatusIcon: ':heavy_check_mark:'
  attributes:
    links:
    - https://nachiavivias.github.io/cp-library/cpp/array/bbst-list.html
  bundledCode: "Traceback (most recent call last):\n  File \"/home/runner/.local/lib/python3.10/site-packages/onlinejudge_verify/documentation/build.py\"\
    , line 71, in _render_source_code_stat\n    bundled_code = language.bundle(stat.path,\
    \ basedir=basedir, options={'include_paths': [basedir]}).decode()\n  File \"/home/runner/.local/lib/python3.10/site-packages/onlinejudge_verify/languages/nim.py\"\
    , line 86, in bundle\n    raise NotImplementedError\nNotImplementedError\n"
  code: "when not declared CPLIB_COLLECTIONS_AVLTREE:\n    const CPLIB_COLLECTIONS_AVLTREE*\
    \ = 1\n    when compileOption(\"mm\", \"orc\") or compileOption(\"mm\", \"arc\"\
    ):\n        {.fatal: \"Plese Use refc\".}\n    # \u4EE5\u4E0B\u3092Nim\u306B\u79FB\
    \u690D\n    # https://nachiavivias.github.io/cp-library/cpp/array/bbst-list.html\n\
    \    type AvlTreeNode*[K] = ref object\n        l*, r*, p*: AvlTreeNode[K]\n \
    \       h*, len*: int\n        key*: K\n    proc get_avltree_nilnode*[K](): AvlTreeNode[K]\
    \ =\n        let nil_node {.global.} = (block:\n            var nil_node = AvlTreeNode[K](h:\
    \ 0, len: 0)\n            nil_node.l = nil_node\n            nil_node.r = nil_node\n\
    \            nil_node.p = nil_node\n            nil_node\n        )\n        return\
    \ nil_node\n    proc update[K](node: AvlTreeNode[K]) =\n        node.h = max(node.l.h\
    \ + 1, node.r.h + 1)\n        node.len = 1 + node.l.len + node.r.len\n    proc\
    \ set_children[K](node, l, r: AvlTreeNode[K]) =\n        node.l = l\n        if\
    \ l != get_avltree_nilnode[K](): l.p = node\n        node.r = r\n        if r\
    \ != get_avltree_nilnode[K](): r.p = node\n        node.update()\n    proc rebalance[K](node:\
    \ AvlTreeNode[K]): AvlTreeNode[K] =\n        var node = node\n        var l =\
    \ node.l\n        var r = node.r\n        if l.h + 1 < r.h:\n            var rl\
    \ = r.l\n            var rr = r.r\n            if rl.h <= rr.h:\n            \
    \    r.p = node.p\n                node.set_children(l, rl)\n                r.set_children(node,\
    \ rr)\n                return r\n            else:\n                rl.p = node.p\n\
    \                node.set_children(l, rl.l)\n                r.set_children(rl.r,\
    \ rr)\n                rl.set_children(node, r)\n                return rl\n \
    \       elif r.h + 1 < l.h:\n            var ll = l.l\n            var lr = l.r\n\
    \            if lr.h <= ll.h:\n                l.p = node.p\n                node.set_children(lr,\
    \ r)\n                l.set_children(ll, node)\n                return l\n   \
    \         else:\n                lr.p = node.p\n                node.set_children(lr.r,\
    \ r)\n                l.set_children(ll, lr.l)\n                lr.set_children(l,\
    \ node)\n                return lr\n        node.update\n        return node\n\
    \    proc rebalance_to_root[K](node: AvlTreeNode[K]): AvlTreeNode[K] =\n     \
    \   var node = node\n        while node.p != get_avltree_nilnode[K]():\n     \
    \       var cp = node.p\n            if cp.l == node: cp.l = node.rebalance\n\
    \            else: cp.r = node.rebalance\n            node = cp\n        return\
    \ node.rebalance\n    proc rootOf*[K](node: AvlTreeNode[K]): AvlTreeNode[K] =\n\
    \        result = node\n        while result.p != get_avltree_nilnode[K](): result\
    \ = result.p\n    proc node_search[K](node: AvlTreeNode[K], key: K, strict: bool):\
    \ (AvlTreeNode[K], AvlTreeNode[K]) =\n        var node = node\n        var result_l\
    \ = get_avltree_nilnode[K]()\n        var result_r = get_avltree_nilnode[K]()\n\
    \        while node != get_avltree_nilnode[K]():\n            if (strict and key\
    \ < node.key) or (not strict and key <= node.key):\n                result_r =\
    \ node\n                node = node.l\n            else:\n                result_l\
    \ = node\n                node = node.r\n        return (result_l, result_r)\n\
    \    proc lower_bound_node*[K](node: AvlTreeNode[K], key: K): (AvlTreeNode[K],\
    \ AvlTreeNode[K]) = node_search[K](node, key, false)\n    proc upper_bound_node*[K](node:\
    \ AvlTreeNode[K], key: K): (AvlTreeNode[K], AvlTreeNode[K]) = node_search[K](node,\
    \ key, true)\n    proc insert*[K](node, x: AvlTreeNode[K]): AvlTreeNode[K] =\n\
    \        if node == get_avltree_nilnode[K](): return x\n        var (ql, qr) =\
    \ node.lower_bound_node(x.key)\n        if ql != get_avltree_nilnode[K]() and\
    \ ql.r == get_avltree_nilnode[K]():\n            ql.set_children(ql.l, x)\n  \
    \          return ql.rebalance_to_root\n        qr.set_children(x, qr.r)\n   \
    \     return qr.rebalance_to_root\n    proc erase*[K](node, x, nxt: AvlTreeNode[K]):\
    \ AvlTreeNode[K] =\n        var xp = x.p\n        result = get_avltree_nilnode[K]()\n\
    \        if x.r == get_avltree_nilnode[K]():\n            var xl = x.l\n     \
    \       if xl != get_avltree_nilnode[K](): xl.p = xp\n            if xp != get_avltree_nilnode[K]():\n\
    \                if xp.l == x: xp.l = xl\n                else: xp.r = xl\n  \
    \          if xp == get_avltree_nilnode[K](): result = xl\n            else: result\
    \ = xp.rebalance_to_root\n        else:\n            var nxtp = nxt.p\n      \
    \      var nxtr = nxt.r\n            if xp != get_avltree_nilnode[K]():\n    \
    \            if xp.l == x: xp.l = nxt\n                else: xp.r = nxt\n    \
    \        nxt.p = xp\n            nxt.l = x.l\n            if nxt.l != get_avltree_nilnode[K]():\
    \ nxt.l.p = nxt\n            if x.r == nxt:\n                nxt.update\n    \
    \            result = nxt.rebalance_to_root\n            else:\n             \
    \   if nxtp.l == nxt: nxtp.l = nxtr\n                else: nxtp.r = nxtr\n   \
    \             if nxtr != get_avltree_nilnode[K](): nxtr.p = nxtp\n           \
    \     nxt.r = x.r\n                nxt.r.p = nxt\n                nxt.update\n\
    \                result = nxtp.rebalance_to_root\n        x.l = get_avltree_nilnode[K]()\n\
    \        x.r = get_avltree_nilnode[K]()\n        x.p = get_avltree_nilnode[K]()\n\
    \        x.update\n    proc next*[K](node: AvlTreeNode[K]): AvlTreeNode[K] =\n\
    \        var node = node\n        if node.r != get_avltree_nilnode[K]():\n   \
    \         node = node.r\n            while node.l != get_avltree_nilnode[K]():\
    \ node = node.l\n            return node\n        while node.p.r == node: node\
    \ = node.p\n        return node.p\n    proc prev*[K](node: AvlTreeNode[K]): AvlTreeNode[K]\
    \ =\n        var node = node\n        if node.l != get_avltree_nilnode[K]():\n\
    \            node = node.l\n            while node.r != get_avltree_nilnode[K]():\
    \ node = node.r\n            return node\n        while node.p.l == node: node\
    \ = node.p\n        return node.p\n    proc get*[K](node: AvlTreeNode[K], idx:\
    \ int): AvlTreeNode[K] =\n        assert idx >= 0\n        if idx >= node.len:\
    \ return get_avltree_nilnode[K]()\n        result = node\n        var idx = idx\n\
    \        while result.l.len != idx:\n            if result.l.len < idx:\n    \
    \            idx -= result.l.len + 1\n                result = result.r\n    \
    \        else:\n                result = result.l\n    proc index*[K](node: AvlTreeNode[K]):\
    \ int =\n        var node = node\n        if node == get_avltree_nilnode[K]():\
    \ return 0\n        result = node.l.len\n        while node.p != get_avltree_nilnode[K]():\n\
    \            if node.p.r == node: result += node.p.l.len + 1\n            node\
    \ = node.p\n\n"
  dependsOn: []
  isVerificationFile: false
  path: cplib/collections/avltreenode.nim
  requiredBy:
  - cplib/collections/avlset.nim
  - cplib/collections/avlset.nim
  - cplib/utils/grid_searcher.nim
  - cplib/utils/grid_searcher.nim
  timestamp: '2024-07-21 20:30:56+09:00'
  verificationStatus: LIBRARY_ALL_AC
  verifiedWith:
  - verify/collections/avlset/multiset/ABC217_index_test.nim
  - verify/collections/avlset/multiset/ABC217_index_test.nim
  - verify/collections/avlset/multiset/ABC236_test.nim
  - verify/collections/avlset/multiset/ABC236_test.nim
  - verify/collections/avlset/multiset/index_right_test.nim
  - verify/collections/avlset/multiset/index_right_test.nim
  - verify/collections/avlset/multiset/ABC337_test.nim
  - verify/collections/avlset/multiset/ABC337_test.nim
  - verify/collections/avlset/multiset/ABC217_gtlt_test.nim
  - verify/collections/avlset/multiset/ABC217_gtlt_test.nim
  - verify/collections/avlset/multiset/ABC234D_access_test.nim
  - verify/collections/avlset/multiset/ABC234D_access_test.nim
  - verify/collections/avlset/multiset/ABC294_test.nim
  - verify/collections/avlset/multiset/ABC294_test.nim
  - verify/collections/avlset/multiset/ABC217_gele_test.nim
  - verify/collections/avlset/multiset/ABC217_gele_test.nim
  - verify/collections/avlset/set/ABC217_index_test.nim
  - verify/collections/avlset/set/ABC217_index_test.nim
  - verify/collections/avlset/set/ABC236_test.nim
  - verify/collections/avlset/set/ABC236_test.nim
  - verify/collections/avlset/set/ABC217_gtlt_test.nim
  - verify/collections/avlset/set/ABC217_gtlt_test.nim
  - verify/collections/avlset/set/ABC234D_access_test.nim
  - verify/collections/avlset/set/ABC234D_access_test.nim
  - verify/collections/avlset/set/ABC294_test.nim
  - verify/collections/avlset/set/ABC294_test.nim
  - verify/collections/avlset/set/ABC217_gele_test.nim
  - verify/collections/avlset/set/ABC217_gele_test.nim
  - verify/utils/grid_searcher/skate_tuple_test.nim
  - verify/utils/grid_searcher/skate_tuple_test.nim
  - verify/utils/grid_searcher/skate_test.nim
  - verify/utils/grid_searcher/skate_test.nim
  - verify/utils/grid_searcher/skate_get_tuple_test.nim
  - verify/utils/grid_searcher/skate_get_tuple_test.nim
  - verify/utils/grid_searcher/skate_get_test.nim
  - verify/utils/grid_searcher/skate_get_test.nim
documentation_of: cplib/collections/avltreenode.nim
layout: document
redirect_from:
- /library/cplib/collections/avltreenode.nim
- /library/cplib/collections/avltreenode.nim.html
title: cplib/collections/avltreenode.nim
---

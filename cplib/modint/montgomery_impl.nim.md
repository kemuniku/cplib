---
data:
  _extendedDependsOn: []
  _extendedRequiredBy:
  - icon: ':heavy_check_mark:'
    path: cplib/modint/modint.nim
    title: cplib/modint/modint.nim
  - icon: ':heavy_check_mark:'
    path: cplib/modint/modint.nim
    title: cplib/modint/modint.nim
  _extendedVerifiedWith:
  - icon: ':heavy_check_mark:'
    path: verify/matrix/matrix_pow_test.nim
    title: verify/matrix/matrix_pow_test.nim
  - icon: ':heavy_check_mark:'
    path: verify/matrix/matrix_pow_test.nim
    title: verify/matrix/matrix_pow_test.nim
  - icon: ':heavy_check_mark:'
    path: verify/matrix/matrix_product_test.nim
    title: verify/matrix/matrix_product_test.nim
  - icon: ':heavy_check_mark:'
    path: verify/matrix/matrix_product_test.nim
    title: verify/matrix/matrix_product_test.nim
  - icon: ':heavy_check_mark:'
    path: verify/modint/barrett/abc277g_dynamic_test.nim
    title: verify/modint/barrett/abc277g_dynamic_test.nim
  - icon: ':heavy_check_mark:'
    path: verify/modint/barrett/abc277g_dynamic_test.nim
    title: verify/modint/barrett/abc277g_dynamic_test.nim
  - icon: ':heavy_check_mark:'
    path: verify/modint/barrett/abc277g_static_test.nim
    title: verify/modint/barrett/abc277g_static_test.nim
  - icon: ':heavy_check_mark:'
    path: verify/modint/barrett/abc277g_static_test.nim
    title: verify/modint/barrett/abc277g_static_test.nim
  - icon: ':heavy_check_mark:'
    path: verify/modint/barrett/dpr_dynamic_test.nim
    title: verify/modint/barrett/dpr_dynamic_test.nim
  - icon: ':heavy_check_mark:'
    path: verify/modint/barrett/dpr_dynamic_test.nim
    title: verify/modint/barrett/dpr_dynamic_test.nim
  - icon: ':heavy_check_mark:'
    path: verify/modint/barrett/dpr_static_test.nim
    title: verify/modint/barrett/dpr_static_test.nim
  - icon: ':heavy_check_mark:'
    path: verify/modint/barrett/dpr_static_test.nim
    title: verify/modint/barrett/dpr_static_test.nim
  - icon: ':heavy_check_mark:'
    path: verify/modint/barrett/keyence2021_dynamic_staticinv_test.nim
    title: verify/modint/barrett/keyence2021_dynamic_staticinv_test.nim
  - icon: ':heavy_check_mark:'
    path: verify/modint/barrett/keyence2021_dynamic_staticinv_test.nim
    title: verify/modint/barrett/keyence2021_dynamic_staticinv_test.nim
  - icon: ':heavy_check_mark:'
    path: verify/modint/barrett/keyence2021_dynamic_test.nim
    title: verify/modint/barrett/keyence2021_dynamic_test.nim
  - icon: ':heavy_check_mark:'
    path: verify/modint/barrett/keyence2021_dynamic_test.nim
    title: verify/modint/barrett/keyence2021_dynamic_test.nim
  - icon: ':heavy_check_mark:'
    path: verify/modint/barrett/keyence2021_static_staticinv_test.nim
    title: verify/modint/barrett/keyence2021_static_staticinv_test.nim
  - icon: ':heavy_check_mark:'
    path: verify/modint/barrett/keyence2021_static_staticinv_test.nim
    title: verify/modint/barrett/keyence2021_static_staticinv_test.nim
  - icon: ':heavy_check_mark:'
    path: verify/modint/barrett/keyence2021_static_test.nim
    title: verify/modint/barrett/keyence2021_static_test.nim
  - icon: ':heavy_check_mark:'
    path: verify/modint/barrett/keyence2021_static_test.nim
    title: verify/modint/barrett/keyence2021_static_test.nim
  - icon: ':heavy_check_mark:'
    path: verify/modint/montgomery/abc277g_dynamic_test.nim
    title: verify/modint/montgomery/abc277g_dynamic_test.nim
  - icon: ':heavy_check_mark:'
    path: verify/modint/montgomery/abc277g_dynamic_test.nim
    title: verify/modint/montgomery/abc277g_dynamic_test.nim
  - icon: ':heavy_check_mark:'
    path: verify/modint/montgomery/abc277g_static_test.nim
    title: verify/modint/montgomery/abc277g_static_test.nim
  - icon: ':heavy_check_mark:'
    path: verify/modint/montgomery/abc277g_static_test.nim
    title: verify/modint/montgomery/abc277g_static_test.nim
  - icon: ':heavy_check_mark:'
    path: verify/modint/montgomery/dpr_dynamic_test.nim
    title: verify/modint/montgomery/dpr_dynamic_test.nim
  - icon: ':heavy_check_mark:'
    path: verify/modint/montgomery/dpr_dynamic_test.nim
    title: verify/modint/montgomery/dpr_dynamic_test.nim
  - icon: ':heavy_check_mark:'
    path: verify/modint/montgomery/dpr_static_test.nim
    title: verify/modint/montgomery/dpr_static_test.nim
  - icon: ':heavy_check_mark:'
    path: verify/modint/montgomery/dpr_static_test.nim
    title: verify/modint/montgomery/dpr_static_test.nim
  - icon: ':heavy_check_mark:'
    path: verify/modint/montgomery/keyence2021_dynamic_staticinv_test.nim
    title: verify/modint/montgomery/keyence2021_dynamic_staticinv_test.nim
  - icon: ':heavy_check_mark:'
    path: verify/modint/montgomery/keyence2021_dynamic_staticinv_test.nim
    title: verify/modint/montgomery/keyence2021_dynamic_staticinv_test.nim
  - icon: ':heavy_check_mark:'
    path: verify/modint/montgomery/keyence2021_dynamic_test.nim
    title: verify/modint/montgomery/keyence2021_dynamic_test.nim
  - icon: ':heavy_check_mark:'
    path: verify/modint/montgomery/keyence2021_dynamic_test.nim
    title: verify/modint/montgomery/keyence2021_dynamic_test.nim
  - icon: ':heavy_check_mark:'
    path: verify/modint/montgomery/keyence2021_static_staticinv_test.nim
    title: verify/modint/montgomery/keyence2021_static_staticinv_test.nim
  - icon: ':heavy_check_mark:'
    path: verify/modint/montgomery/keyence2021_static_staticinv_test.nim
    title: verify/modint/montgomery/keyence2021_static_staticinv_test.nim
  - icon: ':heavy_check_mark:'
    path: verify/modint/montgomery/keyence2021_static_test.nim
    title: verify/modint/montgomery/keyence2021_static_test.nim
  - icon: ':heavy_check_mark:'
    path: verify/modint/montgomery/keyence2021_static_test.nim
    title: verify/modint/montgomery/keyence2021_static_test.nim
  - icon: ':heavy_check_mark:'
    path: verify/tree/diameter_path_dynamic_test.nim
    title: verify/tree/diameter_path_dynamic_test.nim
  - icon: ':heavy_check_mark:'
    path: verify/tree/diameter_path_dynamic_test.nim
    title: verify/tree/diameter_path_dynamic_test.nim
  - icon: ':heavy_check_mark:'
    path: verify/tree/diameter_path_static_test.nim
    title: verify/tree/diameter_path_static_test.nim
  - icon: ':heavy_check_mark:'
    path: verify/tree/diameter_path_static_test.nim
    title: verify/tree/diameter_path_static_test.nim
  _isVerificationFailed: false
  _pathExtension: nim
  _verificationStatusIcon: ':heavy_check_mark:'
  attributes:
    links: []
  bundledCode: "Traceback (most recent call last):\n  File \"/home/runner/.local/lib/python3.10/site-packages/onlinejudge_verify/documentation/build.py\"\
    , line 71, in _render_source_code_stat\n    bundled_code = language.bundle(stat.path,\
    \ basedir=basedir, options={'include_paths': [basedir]}).decode()\n  File \"/home/runner/.local/lib/python3.10/site-packages/onlinejudge_verify/languages/nim.py\"\
    , line 86, in bundle\n    raise NotImplementedError\nNotImplementedError\n"
  code: "when not declared CPLIB_MODINT_MODINT_MONTGOMERY:\n    const CPLIB_MODINT_MODINT_MONTGOMERY*\
    \ = 1\n    import std/macros\n    type StaticMontgomeryModint*[M: static[uint32]]\
    \ = object\n        a: uint32\n    type DynamicMontgomeryModint*[M: static[uint32]]\
    \ = object\n        a: uint32\n    type MontgomeryModint* = StaticMontgomeryModint\
    \ or DynamicMontgomeryModint\n\n    proc get_r*(M: uint32): uint32 =\n       \
    \ result = M\n        for _ in 0..<4: result *= 2u32 - M * result\n    proc get_n2*(M:\
    \ uint32): uint32 = uint32((not uint(M - 1u32)) mod uint(M))\n    proc check_params(M,\
    \ r: uint32) =\n        assert M < (1u32 shl 30), \"invalid mod >= 2^30\"\n  \
    \      assert (M and 1u32) == 1u32, \"invalid mod % 2 == 0\"\n        assert r\
    \ * M == 1, \"r * mod != 1\"\n    func get_param*[M: static[uint32]](self: typedesc[DynamicMontgomeryModint[M]]):\
    \ ptr[tuple[M, r, n2: uint32]] =\n        {.cast(noSideEffect).}:\n          \
    \  var p {.global.}: tuple[M, r, n2: uint32] = (998244353u32, get_r(998244353u32),\
    \ get_n2(998244353u32))\n            return p.addr\n    template get_M*(T: typedesc[MontgomeryModint]):\
    \ uint32 =\n        when T is StaticMontgomeryModint: T.M\n        else: (get_param(T))[].M\n\
    \    proc setMod*[T: static[uint32]](self: typedesc[DynamicMontgomeryModint[T]],\
    \ M: SomeInteger or SomeUnsignedInt) =\n        var r = get_r(M.uint32)\n    \
    \    var n2 = get_n2(M.uint32)\n        var p = (M.uint32, r, n2)\n        (get_param(self))[]\
    \ = p\n        check_params(M.uint32, r)\n\n    template umod*[T: MontgomeryModint](self:\
    \ typedesc[T] or T): uint32 =\n        when self is typedesc:\n            when\
    \ self is StaticMontgomeryModint: self.M\n            else: ((get_param(self))[]).M\n\
    \        else: T.umod\n    template `mod`*[T: MontgomeryModint](self: typedesc[T]\
    \ or T): int32 = (T.umod).int32\n\n    func reduce(T: typedesc[MontgomeryModint],\
    \ b: uint): uint32 =\n        when T is StaticMontgomeryModint:\n            const\
    \ r = get_r(T.M)\n            return cast[uint32]((b + uint(cast[uint32](b) *\
    \ (not (r - 1u32))) * T.M) shr 32)\n        else:\n            var p = (get_param(T))[]\n\
    \            return cast[uint32]((b + uint(cast[uint32](b) * (not (p.r - 1u32)))\
    \ * p.M) shr 32)\n    proc init*(T: typedesc[MontgomeryModint], a: T or SomeInteger):\
    \ auto =\n        when a is T: return a\n        elif T is StaticMontgomeryModint:\n\
    \            const r = get_r(T.M)\n            const n2 = get_n2(T.M)\n      \
    \      check_params(T.M, r)\n            var ai = reduce(T, uint(a.int32 mod T.M.int32\
    \ + T.M.int32) * n2)\n            result = StaticMontgomeryModint[T.M](a: ai)\n\
    \        elif T is DynamicMontgomeryModint:\n            var p = (get_param(T))[]\n\
    \            var ai = reduce(T, uint(a.int32 mod p.M.int32 + p.M.int32) * p.n2)\n\
    \            result = DynamicMontgomeryModint[T.M](a: ai)\n\n    proc `+=`*[T:\
    \ MontgomeryModint](a: var T, b: T or SomeInteger) =\n        a.a += init(T, b).a\
    \ - T.get_M * 2u32\n        if cast[int32](a.a) < 0i32: a.a += T.get_M * 2u32\n\
    \    proc `-=`*[T: MontgomeryModint](a: var T, b: T or SomeInteger) =\n      \
    \  a.a -= init(T, b).a\n        if cast[int32](a.a) < 0i32: a.a += T.get_M * 2u32\n\
    \    proc val*[T: MontgomeryModint](a: T): int =\n        result = reduce(T, a.a).int\n\
    \        if result.uint32 >= T.get_M: result -= T.get_M.int\n\n    proc `-`*[T:\
    \ MontgomeryModint](a: T): T = init(T, 0) - a\n    proc `*=`*[T: MontgomeryModint]\
    \ (a: var T, b: T or SomeInteger) = a.a = reduce(T, uint(a.a) * init(T, b).a)\n\
    \    proc inv*[T: MontgomeryModint](x: T): T =\n        var x: int32 = int32(x.val)\n\
    \        var y: int32 = T.mod\n        var u = 1i32\n        var v, t = 0i32\n\
    \        while y > 0:\n            t = x div y\n            x -= t * y\n     \
    \       u -= t * v\n            swap(x, y)\n            swap(u, v)\n        return\
    \ init(T, u)\n    proc `/=`*[T: MontgomeryModint](a: var T, b: T or SomeInteger)\
    \ = a *= init(T, b).inv\n\n    macro declarStaticMontgomeryModint*(name, M) =\n\
    \        let converter_name = ident(\"to\" & $`name`)\n        quote do:\n   \
    \         type `name`* = StaticMontgomeryModint[`M`]\n            converter `converter_name`*(a:\
    \ int): StaticMontgomeryModint[`M`] = init(StaticMontgomeryModint[`M`], a)\n \
    \   macro declarDynamicMontgomeryModint*(name, id) =\n        let converter_name\
    \ = ident(\"to\" & $`name`)\n        quote do:\n            type `name`* = DynamicMontgomeryModint[`id`]\n\
    \            converter `converter_name`*(a: int): DynamicMontgomeryModint[`id`]\
    \ = init(DynamicMontgomeryModint[`id`], a)\n"
  dependsOn: []
  isVerificationFile: false
  path: cplib/modint/montgomery_impl.nim
  requiredBy:
  - cplib/modint/modint.nim
  - cplib/modint/modint.nim
  timestamp: '2024-04-30 14:50:09+09:00'
  verificationStatus: LIBRARY_ALL_AC
  verifiedWith:
  - verify/tree/diameter_path_dynamic_test.nim
  - verify/tree/diameter_path_dynamic_test.nim
  - verify/tree/diameter_path_static_test.nim
  - verify/tree/diameter_path_static_test.nim
  - verify/matrix/matrix_product_test.nim
  - verify/matrix/matrix_product_test.nim
  - verify/matrix/matrix_pow_test.nim
  - verify/matrix/matrix_pow_test.nim
  - verify/modint/montgomery/abc277g_dynamic_test.nim
  - verify/modint/montgomery/abc277g_dynamic_test.nim
  - verify/modint/montgomery/abc277g_static_test.nim
  - verify/modint/montgomery/abc277g_static_test.nim
  - verify/modint/montgomery/keyence2021_static_test.nim
  - verify/modint/montgomery/keyence2021_static_test.nim
  - verify/modint/montgomery/keyence2021_static_staticinv_test.nim
  - verify/modint/montgomery/keyence2021_static_staticinv_test.nim
  - verify/modint/montgomery/dpr_static_test.nim
  - verify/modint/montgomery/dpr_static_test.nim
  - verify/modint/montgomery/keyence2021_dynamic_test.nim
  - verify/modint/montgomery/keyence2021_dynamic_test.nim
  - verify/modint/montgomery/keyence2021_dynamic_staticinv_test.nim
  - verify/modint/montgomery/keyence2021_dynamic_staticinv_test.nim
  - verify/modint/montgomery/dpr_dynamic_test.nim
  - verify/modint/montgomery/dpr_dynamic_test.nim
  - verify/modint/barrett/abc277g_dynamic_test.nim
  - verify/modint/barrett/abc277g_dynamic_test.nim
  - verify/modint/barrett/abc277g_static_test.nim
  - verify/modint/barrett/abc277g_static_test.nim
  - verify/modint/barrett/keyence2021_static_test.nim
  - verify/modint/barrett/keyence2021_static_test.nim
  - verify/modint/barrett/keyence2021_static_staticinv_test.nim
  - verify/modint/barrett/keyence2021_static_staticinv_test.nim
  - verify/modint/barrett/dpr_static_test.nim
  - verify/modint/barrett/dpr_static_test.nim
  - verify/modint/barrett/keyence2021_dynamic_test.nim
  - verify/modint/barrett/keyence2021_dynamic_test.nim
  - verify/modint/barrett/keyence2021_dynamic_staticinv_test.nim
  - verify/modint/barrett/keyence2021_dynamic_staticinv_test.nim
  - verify/modint/barrett/dpr_dynamic_test.nim
  - verify/modint/barrett/dpr_dynamic_test.nim
documentation_of: cplib/modint/montgomery_impl.nim
layout: document
redirect_from:
- /library/cplib/modint/montgomery_impl.nim
- /library/cplib/modint/montgomery_impl.nim.html
title: cplib/modint/montgomery_impl.nim
---
